Here’s a PostgreSQL data model blueprint for Phases 1–3 of ArcoírisPOS, organized into modular schemas:
	•	core – tenants, users, org-level configuration
	•	pos – sales, payments, customers, terminals
	•	inv – inventory, stock movements
	•	acct – double-entry accounting (Phase 3)
I’ll show table purposes + key columns + example CREATE TABLE skeletons you can refine.
Assumptions:
	•	Multi-tenant with org_id on nearly every table
	•	UUID primary keys
	•	Timestamps and soft-deletes (deleted_at) for most entities

0. PostgreSQL Setup Helpers
-- Enable UUID generation (Postgres 13+ usually has this)
CREATE EXTENSION IF NOT EXISTS "pgcrypto";

-- Optional: a shared enum for transaction types
CREATE TYPE acct_entry_type AS ENUM ('debit', 'credit');

1. core Schema – Organizations, Users, Settings (Phase 1)
1.1 core.organizations
Tenants (businesses) using ArcoírisPOS.
CREATE SCHEMA IF NOT EXISTS core;

CREATE TABLE core.organizations (
    org_id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name            TEXT NOT NULL,
    legal_name      TEXT,
    timezone        TEXT NOT NULL DEFAULT 'UTC',
    base_currency   TEXT NOT NULL DEFAULT 'USD',
    is_active       BOOLEAN NOT NULL DEFAULT TRUE,
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    deleted_at      TIMESTAMPTZ
);
1.2 core.users
Application users; can belong to multiple orgs via a join table.
CREATE TABLE core.users (
    user_id         UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email           CITEXT NOT NULL UNIQUE,
    password_hash   TEXT NOT NULL,
    display_name    TEXT,
    is_active       BOOLEAN NOT NULL DEFAULT TRUE,
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
1.3 core.user_org_roles
Role membership per organization (cashier, manager, admin, accountant).
CREATE TABLE core.user_org_roles (
    user_org_role_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    user_id         UUID NOT NULL REFERENCES core.users(user_id),
    role            TEXT NOT NULL,  -- e.g. 'OWNER','MANAGER','CASHIER','ACCOUNTANT'
    is_primary      BOOLEAN NOT NULL DEFAULT FALSE,
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UNIQUE (org_id, user_id, role)
);

2. pos Schema – Phase 1–2: POS Core
CREATE SCHEMA IF NOT EXISTS pos;
2.1 pos.terminals
Logical POS terminals (could map to devices or browser sessions).
CREATE TABLE pos.terminals (
    terminal_id     UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    name            TEXT NOT NULL,
    location_label  TEXT,
    is_active       BOOLEAN NOT NULL DEFAULT TRUE,
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
2.2 pos.customers
Basic customer records.
CREATE TABLE pos.customers (
    customer_id     UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    external_ref    TEXT,        -- loyalty ID, external system mapping
    full_name       TEXT NOT NULL,
    email           CITEXT,
    phone           TEXT,
    billing_address JSONB,
    shipping_address JSONB,
    notes           TEXT,
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    deleted_at      TIMESTAMPTZ
);
2.3 pos.tax_rates
Configurable tax rules (simple version; later extend to jurisdictions).
CREATE TABLE pos.tax_rates (
    tax_id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    name            TEXT NOT NULL,
    rate_percent    NUMERIC(9,4) NOT NULL,     -- 10.0000 = 10%
    is_compound     BOOLEAN NOT NULL DEFAULT FALSE,
    is_default      BOOLEAN NOT NULL DEFAULT FALSE,
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
Inventory/product tables live under inv but are heavily used by POS.

3. inv Schema – Items & Inventory (Phase 1–2)
CREATE SCHEMA IF NOT EXISTS inv;
3.1 inv.items
Products and services sold through the POS.
CREATE TABLE inv.items (
    item_id         UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    sku             TEXT,   -- unique per org if used
    barcode         TEXT,
    name            TEXT NOT NULL,
    description     TEXT,
    item_type       TEXT NOT NULL, -- 'PRODUCT', 'SERVICE', 'FEE'
    default_price   NUMERIC(18,4) NOT NULL DEFAULT 0,
    cost_basis      NUMERIC(18,4), -- optional; can move to separate costing table later
    tax_id          UUID REFERENCES pos.tax_rates(tax_id),
    is_active       BOOLEAN NOT NULL DEFAULT TRUE,
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    deleted_at      TIMESTAMPTZ
);
3.2 inv.locations
Stock locations (store, warehouse, backroom).
CREATE TABLE inv.locations (
    location_id     UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    name            TEXT NOT NULL,
    code            TEXT,
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    deleted_at      TIMESTAMPTZ
);
3.3 inv.stock_levels
Current on-hand stock per location (optional optimization, can be derived from movements but useful practically).
CREATE TABLE inv.stock_levels (
    stock_level_id  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    item_id         UUID NOT NULL REFERENCES inv.items(item_id),
    location_id     UUID NOT NULL REFERENCES inv.locations(location_id),
    quantity_on_hand NUMERIC(18,4) NOT NULL DEFAULT 0,
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UNIQUE (org_id, item_id, location_id)
);
3.4 inv.stock_movements
Immutable history of how inventory changes — key for future COGS and audit.
CREATE TABLE inv.stock_movements (
    movement_id     UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    item_id         UUID NOT NULL REFERENCES inv.items(item_id),
    location_id     UUID NOT NULL REFERENCES inv.locations(location_id),
    source_type     TEXT NOT NULL,  -- 'SALE','PURCHASE','ADJUSTMENT','TRANSFER'
    source_id       UUID,           -- e.g. sale_id, purchase_id
    quantity_delta  NUMERIC(18,4) NOT NULL,  -- negative for sale, positive for purchase
    unit_cost       NUMERIC(18,4),
    occurred_at     TIMESTAMPTZ NOT NULL,
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

4. pos Schema – Sales & Payments (Phase 1–2)
4.1 pos.sales
High-level sales transactions (like invoices/receipts at POS).
CREATE TABLE pos.sales (
    sale_id         UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    terminal_id     UUID REFERENCES pos.terminals(terminal_id),
    customer_id     UUID REFERENCES pos.customers(customer_id),
    sale_number     TEXT,  -- human-readable incremental number per org
    status          TEXT NOT NULL, -- 'OPEN','COMPLETED','VOID','REFUNDED'
    sale_type       TEXT NOT NULL DEFAULT 'POS', -- future: 'INVOICE','ONLINE'
    subtotal        NUMERIC(18,4) NOT NULL DEFAULT 0,
    tax_total       NUMERIC(18,4) NOT NULL DEFAULT 0,
    discount_total  NUMERIC(18,4) NOT NULL DEFAULT 0,
    grand_total     NUMERIC(18,4) NOT NULL DEFAULT 0,
    amount_paid     NUMERIC(18,4) NOT NULL DEFAULT 0,
    balance_due     NUMERIC(18,4) NOT NULL DEFAULT 0,
    sale_date       TIMESTAMPTZ NOT NULL,
    notes           TEXT,
    created_by      UUID REFERENCES core.users(user_id),
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    deleted_at      TIMESTAMPTZ
);
4.2 pos.sale_lines
Line items for each sale.
CREATE TABLE pos.sale_lines (
    sale_line_id    UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    sale_id         UUID NOT NULL REFERENCES pos.sales(sale_id) ON DELETE CASCADE,
    line_number     INT NOT NULL,
    item_id         UUID NOT NULL REFERENCES inv.items(item_id),
    description     TEXT,
    quantity        NUMERIC(18,4) NOT NULL,
    unit_price      NUMERIC(18,4) NOT NULL,
    discount_amount NUMERIC(18,4) NOT NULL DEFAULT 0,
    tax_id          UUID REFERENCES pos.tax_rates(tax_id),
    tax_amount      NUMERIC(18,4) NOT NULL DEFAULT 0,
    line_total      NUMERIC(18,4) NOT NULL, -- (qty*price - discount + tax)
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UNIQUE (sale_id, line_number)
);
4.3 pos.payments
Payments applied to sales (cash, card, etc.). Will later sync to accounting AR/bank.
CREATE TABLE pos.payments (
    payment_id      UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    sale_id         UUID NOT NULL REFERENCES pos.sales(sale_id) ON DELETE CASCADE,
    payment_method  TEXT NOT NULL, -- 'CASH','CARD','ONLINE','STORE_CREDIT'
    amount          NUMERIC(18,4) NOT NULL,
    currency        TEXT NOT NULL DEFAULT 'USD',
    external_ref    TEXT,          -- gateway transaction id
    processed_at    TIMESTAMPTZ NOT NULL,
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

5. acct Schema – Phase 3 Double-Entry Accounting
CREATE SCHEMA IF NOT EXISTS acct;
5.1 acct.chart_of_accounts
The master list of accounts per org.
CREATE TABLE acct.chart_of_accounts (
    account_id      UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    code            TEXT NOT NULL,    -- e.g. '1000'
    name            TEXT NOT NULL,    -- e.g. 'Cash'
    type            TEXT NOT NULL,    -- 'ASSET','LIABILITY','EQUITY','REVENUE','EXPENSE'
    subtype         TEXT,             -- 'BANK','ACCOUNTS_RECEIVABLE', etc.
    is_active       BOOLEAN NOT NULL DEFAULT TRUE,
    parent_id       UUID REFERENCES acct.chart_of_accounts(account_id),
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UNIQUE (org_id, code)
);
5.2 acct.journal_entries
Header for each journal (transaction).
CREATE TABLE acct.journal_entries (
    journal_id      UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    journal_number  TEXT,            -- optional human-visible sequence
    source_type     TEXT,            -- 'POS_SALE','BANK_IMPORT','MANUAL'
    source_id       UUID,            -- e.g. sale_id, payment_id
    description     TEXT,
    journal_date    DATE NOT NULL,
    posted          BOOLEAN NOT NULL DEFAULT FALSE,
    created_by      UUID REFERENCES core.users(user_id),
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
5.3 acct.journal_lines
Debit/credit lines per journal, enforcing double-entry.
CREATE TABLE acct.journal_lines (
    journal_line_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    journal_id      UUID NOT NULL REFERENCES acct.journal_entries(journal_id) ON DELETE CASCADE,
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    line_number     INT NOT NULL,
    account_id      UUID NOT NULL REFERENCES acct.chart_of_accounts(account_id),
    entry_type      acct_entry_type NOT NULL, -- 'debit' or 'credit'
    amount          NUMERIC(18,4) NOT NULL CHECK (amount > 0),
    memo            TEXT,
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UNIQUE (journal_id, line_number)
);
You can add a constraint or trigger to ensure each journal has SUM(debits) = SUM(credits) before posted = TRUE.
5.4 acct.customers_ledger (AR helper)
Optional denormalized view/table linking accounting entries to customers.
CREATE TABLE acct.customer_balances (
    customer_balance_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    customer_id     UUID NOT NULL REFERENCES pos.customers(customer_id),
    account_id      UUID NOT NULL REFERENCES acct.chart_of_accounts(account_id), -- AR account
    balance         NUMERIC(18,4) NOT NULL DEFAULT 0,
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UNIQUE (org_id, customer_id, account_id)
);
(You can also derive this by querying journal lines; this table is for speed.)
5.5 acct.bank_accounts
Link bank accounts to chart-of-accounts entries.
CREATE TABLE acct.bank_accounts (
    bank_account_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id          UUID NOT NULL REFERENCES core.organizations(org_id),
    account_id      UUID NOT NULL REFERENCES acct.chart_of_accounts(account_id),
    display_name    TEXT NOT NULL,
    institution     TEXT,
    last4           TEXT,
    currency        TEXT NOT NULL DEFAULT 'USD',
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UNIQUE (org_id, account_id)
);

6. POS → Accounting Integration Points (Phase 3 Logic)
You don’t need extra tables here yet — just rules for how pos events create acct entries.
Example 1: Completed Sale with Card Payment
On pos.sales status → COMPLETED:
	1	Create a journal entry with:
	◦	Debit Accounts Receivable or Cash/Bank
	◦	Credit Sales Revenue
	◦	Credit Tax Payable
	2	If inventory tracked:
	◦	Debit Cost of Goods Sold
	◦	Credit Inventory based on inv.stock_movements.
Example 2: Payment Recorded (if you use AR model)
On pos.payments insert:
	•	Debit Cash/Bank
	•	Credit Accounts Receivable
These rules live in application code (FastAPI services) and populate acct.journal_entries + acct.journal_lines.

7. Phase-by-Phase Coverage Check
✅ Phase 1 – Core POS & Data Model
	•	core.organizations, core.users, core.user_org_roles
	•	pos.terminals, pos.customers, pos.tax_rates
	•	inv.items (basic, with price + tax)
	•	pos.sales, pos.sale_lines, pos.payments
✅ Phase 2 – Inventory & Operational POS
	•	inv.locations, inv.stock_levels, inv.stock_movements
	•	Extended fields on inv.items for COGS, categories, etc.
✅ Phase 3 – Double-Entry Accounting
	•	acct.chart_of_accounts
	•	acct.journal_entries, acct.journal_lines
	•	acct.customer_balances, acct.bank_accounts
	•	POS→Accounting mapping rules in services

If you’d like, I can next:
	•	Turn this into a single SQL migration file you can drop into your repo
	•	Add indexes and constraints (e.g., partial indexes for active records)
	•	Draw an ER diagram (text-based or Mermaid) for visual planning
	•	Design the Phase 4 SaaS tables (subscriptions, plans, invoices, usage)
